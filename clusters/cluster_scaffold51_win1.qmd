---
title: "Cluster scaffold51_win1 (scaffold_51: 461513-803596)"
---

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(DT)
library(knitr)
library(here)

# Read cluster metadata for just this cluster
meta <- readr::read_csv("../data/clusters_metadata.csv", show_col_types = FALSE) %>%
  mutate(cluster_id = as.character(cluster_id)) %>%
  filter(cluster_id == "scaffold51_win1") %>%
  slice(1)

# Read GO annotations for just this cluster
ann <- readr::read_csv("../data/GO_annotation.csv", show_col_types = FALSE) %>%
  mutate(cluster_id = as.character(cluster_id)) %>%
  filter(cluster_id == "scaffold51_win1")

# Web paths for HTML (cluster pages are in docs/clusters)
pca_web     <- file.path('..', meta$pca_img)
rda_env_web     <- file.path('..', meta$rda_env_img)
rda_pheno_web     <- file.path('..', meta$rda_pheno_img)
heatmap_web <- file.path('..', meta$heatmap_img)
network_web <- file.path('..', meta$network_img)

# Disk paths for existence + include_graphics (anchor to project root)
pca_file     <- here::here(meta$pca_img)
rda_env_file     <- here::here(meta$rda_env_img)
rda_pheno_file     <- here::here(meta$rda_pheno_img)
heatmap_file <- here::here(meta$heatmap_img)
network_file <- here::here(meta$network_img)

has_pca     <- file.exists(pca_file)
has_rda_env     <- file.exists(rda_env_file)
has_rda_pheno     <- file.exists(rda_pheno_file)
has_heatmap <- file.exists(heatmap_file)
has_network <- file.exists(network_file)
```

## Summary

- Scaffold: `r meta$scaffold`
- Region (bp): `r format(meta$start_bp, big.mark = ",")`–`r format(meta$end_bp, big.mark = ",")`
- SNPs: `r meta$n_snps`

## PCA

```{r echo=FALSE, out.width='90%', fig.align='center'}
if (has_pca) {
  knitr::include_graphics(pca_file)
} else {
  cat('*PCA image not found yet:* ', pca_web)
}
```

## Partial RDA – Environmental variables

```{r echo=FALSE, out.width='90%', fig.align='center'}
if (has_rda_env) {
  knitr::include_graphics(rda_env_file)
} else {
  cat('*Environmental pRDA image not found yet:* ', rda_env_web)
}
```

## Partial RDA – Phenotypic variables

```{r echo=FALSE, out.width='90%', fig.align='center'}
if (has_rda_pheno) {
  knitr::include_graphics(rda_pheno_file)
} else {
  cat('*Phenotypic pRDA image not found yet:* ', rda_pheno_web)
}
```

## LD network

```{r echo=FALSE, out.width='95%', fig.align='center'}
if (has_network) {
  knitr::include_graphics(network_file)
} else {
  cat('*LD network not found yet:* ', network_web)
}
```

## LD heatmap

```{r echo=FALSE, out.width='75%', fig.align='center'}
if (has_heatmap) {
  knitr::include_graphics(heatmap_file)
} else {
  cat('*LD heatmap not found yet:* ', heatmap_web)
}
```

## GO annotations

```{r echo=FALSE}
DT::datatable(
  ann,
  rownames = FALSE,
  options = list(pageLength = 25, scrollX = TRUE)
)
```

